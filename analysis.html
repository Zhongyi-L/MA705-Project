<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Analysis &amp; Results – MA705 Project – Adolescent Fertility</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-e31584831b205ffbb2d98406f31c2a5b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MA705 Project – Adolescent Fertility</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./methods.html"> 
<span class="menu-text">Methods</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./analysis.html" aria-current="page"> 
<span class="menu-text">Analysis &amp; Results</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview-of-the-analysis" id="toc-overview-of-the-analysis" class="nav-link active" data-scroll-target="#overview-of-the-analysis">Overview of the analysis</a>
  <ul class="collapse">
  <li><a href="#basic-statistical-modeling-analysis" id="toc-basic-statistical-modeling-analysis" class="nav-link" data-scroll-target="#basic-statistical-modeling-analysis">Basic statistical / modeling analysis</a></li>
  </ul></li>
  <li><a href="#differences-by-income-group" id="toc-differences-by-income-group" class="nav-link" data-scroll-target="#differences-by-income-group">2. Differences by income group</a></li>
  <li><a href="#time-trends-by-income-group" id="toc-time-trends-by-income-group" class="nav-link" data-scroll-target="#time-trends-by-income-group">3. Time trends by income group</a></li>
  <li><a href="#time-trends-for-selected-countries" id="toc-time-trends-for-selected-countries" class="nav-link" data-scroll-target="#time-trends-for-selected-countries">4. Time trends for selected countries</a></li>
  <li><a href="#interactive-world-map-in-1960" id="toc-interactive-world-map-in-1960" class="nav-link" data-scroll-target="#interactive-world-map-in-1960">5. Interactive world map in 1960</a></li>
  <li><a href="#interactive-world-map-in-2023" id="toc-interactive-world-map-in-2023" class="nav-link" data-scroll-target="#interactive-world-map-in-2023">6. Interactive world map in 2023</a></li>
  <li><a href="#brief-regression-summary" id="toc-brief-regression-summary" class="nav-link" data-scroll-target="#brief-regression-summary">7. Brief regression summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analysis &amp; Results</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview-of-the-analysis" class="level2">
<h2 class="anchored" data-anchor-id="overview-of-the-analysis">Overview of the analysis</h2>
<p>In this section, we present the main statistical analysis and visualizations based on our adolescent fertility dataset. Our goal is to describe global patterns, differences across income groups and regions, and how adolescent fertility has changed over time.</p>
<section id="basic-statistical-modeling-analysis" class="level3">
<h3 class="anchored" data-anchor-id="basic-statistical-modeling-analysis">Basic statistical / modeling analysis</h3>
<p>Before building visualizations or regression models, we first compute some descriptive statistics for adolescent fertility rates across all country-year observations in the cleaned dataset. These summary statistics provide a baseline understanding of the global distribution and help motivate the patterns we explore later in the analysis.</p>
<p>At a high level, adolescent fertility is strongly right-skewed: most countries record relatively low birth rates among girls aged 15–19, while a smaller set of primarily low-income countries show much higher fertility levels.</p>
<p><strong>Key patterns from the basic statistics:</strong></p>
<ul>
<li><p><strong>Income and development level:</strong><br>
High-income and OECD/European regions consistently appear at the lowest end of the fertility distribution. In contrast, low-income regions—especially Sub-Saharan Africa—display both higher average fertility rates and much larger within-region variation.</p></li>
<li><p><strong>Regional differences:</strong><br>
Sub-Saharan Africa has the highest mean adolescent fertility rate and the largest standard deviation, reflecting substantial diversity across countries. Regions such as Europe &amp; Central Asia and North America cluster tightly at the low end of the distribution.</p></li>
<li><p><strong>Trends over time:</strong><br>
Most regions show a long-run decline in adolescent fertility, but the magnitude of this decline varies: some countries experience sharp downward shifts, while others remain relatively unchanged.</p></li>
</ul>
<p>These descriptive statistics set the stage for the visual and modeling sections that follow. By establishing how adolescent fertility varies by income level, region, and time, we can better interpret the heat maps, histograms, interactive visualizations, and regression analyses presented later in the report.</p>
<div id="efe16393" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the cleaned data saved from the notebook</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"df_clean.csv"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># If your fertility column has a different name,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># change "adolescent_fertility" here.</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>col <span class="op">=</span> <span class="st">"adolescent_fertility"</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary by income group</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>summary_income <span class="op">=</span> (</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">"income_group"</span>)[col]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>.agg(n_obs<span class="op">=</span><span class="st">"count"</span>, mean<span class="op">=</span><span class="st">"mean"</span>, median<span class="op">=</span><span class="st">"median"</span>, std<span class="op">=</span><span class="st">"std"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>.reset_index()</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>.sort_values(<span class="st">"income_group"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>summary_income</p>
<p>The table above reports, for each income group, the number of observations (number_of_obs), the mean, median, and standard deviation of adolescent fertility (births per 1,000 women ages 15–19). This makes the differences between low-, lower-middle-, upper-middle-, and high-income countries visible in numerical form. ## 1. Distribution of adolescent fertility</p>
<p>The first figure is a histogram of the adolescent fertility rate (births per 1,000 women ages 15–19) using all available country–year observations in the cleaned dataset.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/hist_adolescent_fertility.png" class="img-fluid figure-img"></p>
<figcaption>Histogram of adolescent fertility</figcaption>
</figure>
</div>
<p>From this histogram, we see that most adolescent fertility values are concentrated at relatively lower levels, for example between 0 and 100 births per 1,000 women 15–19. However, there is a long right tail with some country–years that have much higher fertility. This suggests large differences across countries and time periods, and motivates looking at how these differences are structured by income group and region.</p>
<hr>
</section>
</section>
<section id="differences-by-income-group" class="level2">
<h2 class="anchored" data-anchor-id="differences-by-income-group">2. Differences by income group</h2>
<p>Next, we compare the distribution of adolescent fertility across World Bank income groups using boxplots.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/box_plot.png" class="img-fluid figure-img"></p>
<figcaption>Boxplots of adolescent fertility by income group</figcaption>
</figure>
</div>
<p>The boxplots show a clear pattern:</p>
<ul>
<li>Low-income and lower-middle-income countries have higher median adolescent fertility and more variability.</li>
<li>Upper-middle-income countries have intermediate levels.</li>
<li>High-income countries have the lowest median adolescent fertility and relatively few extreme values.</li>
</ul>
<p>This confirms that adolescent fertility is strongly related to income level, at least in descriptive terms. The spread of values is also much larger in lower-income groups, indicating more heterogeneity among those countries.</p>
<hr>
</section>
<section id="time-trends-by-income-group" class="level2">
<h2 class="anchored" data-anchor-id="time-trends-by-income-group">3. Time trends by income group</h2>
<p>We then look at how adolescent fertility has changed over time in each income group. For this, we compute the mean adolescent fertility within each income group and year and plot one line per group from 1960 to 2023.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/line_income_group.png" class="img-fluid figure-img"></p>
<figcaption>Mean adolescent fertility by income group over time</figcaption>
</figure>
</div>
<p>All income groups show a downward trend in adolescent fertility over time, which indicates global progress. However, the levels and slopes differ noticeably:</p>
<ul>
<li>Low-income countries start at very high fertility levels and decline gradually but remain much higher than other groups.</li>
<li>Lower-middle-income countries begin at high levels but show a strong decline over the decades.</li>
<li>Upper-middle-income countries follow a similar downward pattern at intermediate levels.</li>
<li>High-income countries start at much lower levels and decline to very low fertility in recent years.</li>
</ul>
<p>The lines do not fully converge, which suggests that while everyone is moving downward, the gaps between income groups remain large.</p>
<hr>
</section>
<section id="time-trends-for-selected-countries" class="level2">
<h2 class="anchored" data-anchor-id="time-trends-for-selected-countries">4. Time trends for selected countries</h2>
<p>To illustrate country-specific trajectories, we select four representative countries:</p>
<ul>
<li><strong>Ethiopia</strong> – low income, high fertility,<br>
</li>
<li><strong>India</strong> – lower-middle income with strong decline,<br>
</li>
<li><strong>Brazil</strong> – upper-middle income,<br>
</li>
<li><strong>Japan</strong> – high income with very low fertility.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/line_selected_countries.png" class="img-fluid figure-img"></p>
<figcaption>Adolescent fertility for selected countries</figcaption>
</figure>
</div>
<p>This plot shows very different starting levels and speeds of decline:</p>
<ul>
<li>Ethiopia starts at extremely high adolescent fertility and remains high for many years, although there is a gradual decline in more recent decades.</li>
<li>India also starts at high levels but shows a strong and sustained decline, especially after around the 1990s.</li>
<li>Brazil begins at medium levels and steadily declines over time.</li>
<li>Japan has very low adolescent fertility throughout the entire period, with small fluctuations around a low baseline.</li>
</ul>
<p>Together, these four trajectories illustrate how income, region, and country-specific factors can lead to very different patterns, even though the overall global trend is downward.</p>
<hr>
</section>
<section id="interactive-world-map-in-1960" class="level2">
<h2 class="anchored" data-anchor-id="interactive-world-map-in-1960">5. Interactive world map in 1960</h2>
<p>We use a choropleth world map to visualize the geographic distribution of adolescent fertility in <strong>1960</strong>, the first year in our dataset. Each country is colored according to its adolescent fertility rate in that year.</p>
<p>The map below is interactive: we can hover over a country to see its name and exact value, and use the toolbar to zoom and pan.</p>
<iframe src="figs/map_1960.html" width="100%" height="500px">
</iframe>
<p>In 1960, high adolescent fertility is widespread across many low-income regions, especially in parts of Sub-Saharan Africa and some other developing areas. While some high-income regions already display lower fertility levels, the overall picture is one of generally high adolescent fertility across much of the world.</p>
<hr>
</section>
<section id="interactive-world-map-in-2023" class="level2">
<h2 class="anchored" data-anchor-id="interactive-world-map-in-2023">6. Interactive world map in 2023</h2>
<p>We create a second interactive map for <strong>2023</strong>, one of the most recent years in the dataset, using the same color scale and projection so that it can be directly compared to the 1960 map.</p>
<iframe src="figs/map_2023.html" width="100%" height="500px">
</iframe>
<p>The 2023 map shows substantial global progress: adolescent fertility has decreased in many regions, particularly in upper-middle- and high-income countries. However, some countries and regions, especially in parts of Sub-Saharan Africa, still have high adolescent fertility rates. Comparing the 1960 and 2023 maps side by side makes it clear that global progress has been uneven and that large geographic disparities remain.</p>
<hr>
</section>
<section id="brief-regression-summary" class="level2">
<h2 class="anchored" data-anchor-id="brief-regression-summary">7. Brief regression summary</h2>
<p>Finally, we fit simple regression models (not shown in detail here) with adolescent fertility as the response and predictors such as <code>Year</code> and income group indicators. These models confirm two main patterns that we see in the plots:</p>
<ul>
<li>A significant negative relationship between <code>Year</code> and adolescent fertility, summarizing the global downward trend over time.</li>
<li>Significant differences between income groups, with low-income countries having higher expected adolescent fertility than high-income countries, even after controlling for the time trend.</li>
</ul>
<p>Overall, the descriptive statistics, visualizations, and simple regression results tell a consistent story: adolescent fertility has fallen substantially worldwide since 1960, but it remains much higher in many low-income and some lower-middle-income countries, leading to persistent inequalities across income groups and regions.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>